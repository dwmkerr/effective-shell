<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HZFMZV9Z4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8HZFMZV9Z4",{anonymize_ip:!0})</script><title data-react-helmet="true">Build Commands on the Fly | Effective Shell</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://effective-shell.com/part-3-manipulating-text/build-commands-on-the-fly/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Build Commands on the Fly | Effective Shell"><meta data-react-helmet="true" name="description" content="In the earlier chapters of this part of the book we&#x27;ve seen a number of ways to manipulate text. Now we&#x27;re going to introduce the xargs command and show how to use our text manipulation skills to dynamically build complex commands on the fly."><meta data-react-helmet="true" property="og:description" content="In the earlier chapters of this part of the book we&#x27;ve seen a number of ways to manipulate text. Now we&#x27;re going to introduce the xargs command and show how to use our text manipulation skills to dynamically build complex commands on the fly."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://effective-shell.com/part-3-manipulating-text/build-commands-on-the-fly/"><link data-react-helmet="true" rel="alternate" href="https://effective-shell.com/part-3-manipulating-text/build-commands-on-the-fly/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://effective-shell.com/part-3-manipulating-text/build-commands-on-the-fly/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.078694be.css">
<link rel="preload" href="/assets/js/runtime~main.c9e750a8.js" as="script">
<link rel="preload" href="/assets/js/main.feaa3aec.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Effective Shell Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="Effective Shell Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Effective Shell</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">Home</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Effective Shell</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/part-1-transitioning-to-the-shell/">Transitioning to the Shell</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transitioning to the Shell&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/part-2-core-skill/">Core Skills</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core Skills&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/part-3-manipulating-text/">Manipulating Text and Streams</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manipulating Text and Streams&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-3-manipulating-text/regex-essentials/">Regex Essentials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-3-manipulating-text/get-to-grips-with-grep/">Get to Grips with Grep</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-3-manipulating-text/slice-and-dice-text/">Slice and Dice Text</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-3-manipulating-text/advanced-text-manipulation/">Advanced Text Manipulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/part-3-manipulating-text/build-commands-on-the-fly/">Build Commands on the Fly</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/part-4-shell-scripting/">Shell Scripting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Shell Scripting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/part-5-building-your-toolkit/">Building Your Toolkit</a><button aria-label="Toggle the collapsible sidebar category &#x27;Building Your Toolkit&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/part-6-advanced-techniques/">Advanced Techniques</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Techniques&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Build Commands on the Fly</h1></header><p>In the earlier chapters of this part of the book we&#x27;ve seen a number of ways to manipulate text. Now we&#x27;re going to introduce the <code>xargs</code> command and show how to use our text manipulation skills to dynamically build complex commands on the fly.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="introducing-xargs">Introducing Xargs<a class="hash-link" href="#introducing-xargs" title="Direct link to heading">â€‹</a></h2><p>The <code>xargs</code> <!-- -->[<em>build and execute commands</em>]<!-- --> command takes input, uses the input to create commands, then executes the commands. I tend to remember it as &quot;Execute with Arguments&quot; as the name <code>xargs</code> sounds a little odd!</p><p>How <code>xargs</code> is used is probably easiest to see with an example. Let&#x27;s use it to build a set of commands which will remove any empty files from a folder.</p><p>Before we show <code>xargs</code> let&#x27;s create some empty files which we&#x27;ll later clean up:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir -p ~/effective-shell/tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/effective-shell/tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ touch file{1..100}.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We&#x27;re using a nice shell trick here called <em>Brace Expansion</em> - the shell will expand <code>file{1..100}.txt</code> into <code>file1.txt</code>, <code>file2.txt</code> and so on, all the way to <code>file100.txt</code>.</p><p>We could just look for empty files in our <code>/tmp</code> folder for this example, but a file in that folder might be in use, so a safer way to demonstrate <code>xargs</code> is to use some temporary files which we create ourselves.</p><p>We could search for empty files with the command below:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file3.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file4.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file5.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>A refresher on Finding Files</h5></div><div class="admonition-content"><p>In this chapter we&#x27;ll be using the <code>find</code> (<em>find files and folders</em>) command a lot - if you need a refresher, check <a href="/part-2-core-skills/finding-files">Chapter 11 - Finding Files</a>.</p></div></div><p>The <code>find</code> command has outputted a list of files, now we want to use the <code>rm</code> (<em>remove file</em>) command to delete each one. Let&#x27;s just <em>pipe</em> the list of files to the <code>rm</code> command, check <a href="/part-2-core-skills/navigating-your-system/">Chapter 7 - Thinking in Pipelines</a> if you need a reminder of how piping works:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -empty | rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm: missing operand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Try &#x27;rm --help&#x27; for more information.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>What&#x27;s going on here? Well basically the issue is that the <code>rm</code> command doesn&#x27;t actually read the list of files from <em>stdin</em>, the list of files has to be passed as a parameter to the command. How can we take this list of files and pass it to <code>rm</code> as a set of parameters?</p><p>This is what <code>xargs</code> is for! Before we delete the files, let&#x27;s just see what happens when we pass the list to <code>xargs</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -empty | xargs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file40.txt ./file8.txt ./file35.txt ./file81.txt ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>By default <code>xargs</code> take the input, joins each line together with a space and then passes it to the <code>echo</code> command. The <code>echo</code> command writes it out to the screen.</p><p>We can change the command <code>xargs</code> passes the arguments to:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -empty | xargs echo rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm ./file40.txt ./file8.txt ./file35.txt ./file81.txt ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Very interesting! Now we&#x27;ve told <code>xargs</code> to pass the output to the <code>echo rm</code> command - this just writes out <code>rm</code> followed by the list of files. Putting <code>echo</code> before whatever command you want to run is a useful way to <em>check</em> the command before we commit to running it.</p><p>Let&#x27;s finish the job and delete each file:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -empty | xargs rm</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Done! You can run <code>ls</code> to confirm that the file has been deleted.</p><p>This is <code>xargs</code> - it <em>constructs and executes</em> a command using <em>arguments</em> from <em>standard input</em>. Now let&#x27;s see how we can take this further.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="handling-whitespace-special-characters-and-tracing">Handling Whitespace, Special Characters and Tracing<a class="hash-link" href="#handling-whitespace-special-characters-and-tracing" title="Direct link to heading">â€‹</a></h2><p>One common challenge with <code>xargs</code> is how to deal with spaces. To see what I mean, let&#x27;s create three files with spaces in the names:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ touch &quot;chapter &quot;{1,2,3}.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./chapter 1.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./chapter 2.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./chapter 3.md</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>What if we wanted to delete these files? Let&#x27;s try that with <code>rm</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f | xargs rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm: cannot remove &#x27;./chapter&#x27;: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm: cannot remove &#x27;1.md&#x27;: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The file name has a space in it, which is confusing <code>rm</code> as it thinks we&#x27;re providing six paths rather than three.</p><p>We can use the <code>-t</code> (<em>trace</em>) option to see what <code>xargs</code> actually tried to do:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f | xargs -t rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm ./chapter 1.md ./chapter 2.md ./chapter 3.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Hopefully you can spot the error - the <code>rm</code> command thinks it needs to remove six files, because there are spaces in the filenames and there are not quotes around the filenames to let <code>rm</code> know this!</p><p>Fortunately, <code>find</code> loves <code>xargs</code> - they are part of the same package of tools (which is called &#x27;findutils&#x27;). And there&#x27;s a special pair of options that can deal with this.</p><p>For find, we are going to use the <code>-print0</code> action and for <code>xargs</code> we&#x27;ll use the <code>-0</code> option. Let&#x27;s see how it looks now, then describe what&#x27;s going on under the hood:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f -print0 | xargs -0 -t rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm &#x27;./chapter 1.md&#x27; &#x27;./chapter 2.md&#x27; &#x27;./chapter 3.md&#x27; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In <a href="/part-2-core-skills/finding-files">Chapter 11 - Finding Files</a> we saw that the <em>default</em> action of the <code>find</code> command is <code>-print</code>, which writes out the path of each item found. The <code>-print0</code> action is very similar - but it instead it writes out each item followed by a special &#x27;null&#x27; character<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>.</p><p>Now that we&#x27;ve told <code>find</code> to end each result with a special &#x27;null&#x27; character, we just tell <code>xargs</code> that the &#x27;null&#x27; character is what separates each line of input. We do this with the <code>-0</code> (<em>use NUL as separators</em>) option.</p><p>You don&#x27;t need to really understand the internals - if you are a computer programmer it might make sense, this is how strings in things like the C Programming language work. All you need to know is that it means the <code>xargs</code> program won&#x27;t get confused when it sees spaces, tabs, quotes, newlines, or anything else which might be goofy in a file name.</p><p>My recommendation would be to <em>always</em> pair up the <code>-print0</code> action with the <code>-0</code> option - it means you won&#x27;t get caught out by odd file names. And definitely make use of the <code>-t</code> (<em>trace</em>) option to see what <code>xargs</code> is actually doing!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="one-command-or-many-commands">One Command or Many Commands?<a class="hash-link" href="#one-command-or-many-commands" title="Direct link to heading">â€‹</a></h2><p>By default <code>xargs</code> takes all of the input and passes it as a <em>set</em> of arguments to the provided command. We can see this below:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ touch file{1..5}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f | xargs echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file1 ./file2 ./file3 ./file4 ./file5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We don&#x27;t need to provide <code>echo</code> to <code>xargs</code>, it is the default, but I have added it for clarity. But what is really important is that we have called <code>echo</code> once and once only.</p><p><code>xargs</code> has passed <em>all</em> of the arguments it has been given to the command.</p><p>We can tell <code>xargs</code> how many lines of input it should use for the command with the <code>-L</code> (<em>max lines</em>) parameter:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f | xargs -L 1 echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We&#x27;ve now called the <code>echo</code> command once for each line of input, meaning that <code>echo</code> has been called five times.</p><p>In general if you can provide all of the arguments to a single command the system may be able to process the command slightly faster. However, if there are lots of arguments, the command itself might not be able to handle all of the arguments you give it.</p><p>You can set <code>-L</code> to other values too - <code>xargs</code> will use up to the number of lines provided:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f | xargs -L 3 echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file1 ./file2 ./file3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./file4 ./file5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here we&#x27;ve allowed up to three input lines per command.</p><p>You will probably <em>not</em> use the <code>-L</code> parameter very often, but it is really important that you understand what it does. And that is because many of the other options we&#x27;ll use <em>imply</em> <code>-L 1</code> - we&#x27;ll see why in the next example.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">find . -name &quot;chapter*&quot; | xargs rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm: cannot remove &#x27;./chapter&#x27;: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm: cannot remove &#x27;1.txt&#x27;: No such file or directory</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="constructing-more-complex-commands-with-the-i-parameter">Constructing more complex commands with the &#x27;I&#x27; Parameter<a class="hash-link" href="#constructing-more-complex-commands-with-the-i-parameter" title="Direct link to heading">â€‹</a></h2><p>You have probably noticed by now that the <code>xargs</code> command puts the arguments it is given at the end of the command you write.</p><p>What if you need the arguments to go somewhere else? For example, what if I wanted to copy every text file in a folder to another location?</p><p>Here&#x27;s how we might start - and what&#x27;ll go wrong!</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -name &quot;*.txt&quot; -print0 | xargs -0 -t cp ~/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /home/dwmkerr/backups ./file2.txt ./file3.txt ./file1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp: target &#x27;./file1.txt&#x27; is not a directory</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The problem is that the destination location for where we copy the files has to be the <em>last</em> parameter - but <code>xargs</code> puts the list of files at the end of the command.</p><p>And by the way - we&#x27;ve used the <code>-0</code> parameter to make sure that funny filenames are handled properly (a good habit to get into) and the <code>-t</code> parameter to trace - which means we see the command which will be run.</p><p>So we need to tell <code>xargs</code> where to put the list of arguments. We can do that with the <code>-I</code> (<em>replace string</em>) parameter. This parameter lets us tell <code>xargs</code> exactly where we want to put the arguments:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -name &quot;*.txt&quot; -print0 | xargs -0 -t -I {} cp {} ~/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file2.txt /home/dwmkerr/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file3.txt /home/dwmkerr/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file1.txt /home/dwmkerr/backups</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here we have set the &#x27;replacement string&#x27; to be <code>{}</code>. This means when <code>xargs</code> sees <code>{}</code> in the command it will replace it with the arguments we provide as its input.</p><p>The first observation you might make is that as soon as we use the <code>-I</code> parameter it <em>automatically</em> implies that we use the <code>-L 1</code> parameter, i.e. we run the command once for each individual input line.</p><p>For the example we have shown above, this isn&#x27;t really necessary, <code>xargs</code> could just write all of the arguments. The reason <code>xargs</code> does this is that we are not actually limited to using the replacement once only - we can use it multiple times.</p><p>Here&#x27;s a similar example, but in this one we put <code>.bak</code> at the end of each filename as we copy it:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -name &quot;*.txt&quot; -print0 | xargs -0 -t -I {} cp {} ~/backups/{}.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file2.txt /home/dwmkerr/backups/./file2.txt.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file3.txt /home/dwmkerr/backups/./file3.txt.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ./file1.txt /home/dwmkerr/backups/./file1.txt.bak</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Because we can use the replacement string multiple times, <code>xargs</code> splits up the commands so it is one command per input argument. If it didn&#x27;t do this and we tried the command above it would not work properly.</p><p>The <code>-I</code> parameter is incredibly powerful, it lets us construct complex commands.</p><p>You don&#x27;t need to use the <code>{}</code> letters as the replacement string, any sequence of characters will work. For example:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ env | xargs -I % echo &quot;You have env var: % set!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have env var: SHELL=/bin/bash set!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have env var: COLORTERM=truecolor set!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have env var: EDITOR=vi set!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this example we used <code>%</code> as the replacement string.</p><p>You might wonder why is <code>{}</code> so commonly used in examples or the manpages. The reason is that this is the default replacement string used by <code>find</code> if we perform an action like <code>-exec</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ find . -type f -empty -exec stat {} \;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>{}</code> characters are used as the placeholder for files found with the <code>find</code> command, so people often use the same placeholder for <code>xargs</code>, but you are not required to use these characters.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requesting-confirmation-with-the-prompt-option">Requesting Confirmation with the Prompt Option<a class="hash-link" href="#requesting-confirmation-with-the-prompt-option" title="Direct link to heading">â€‹</a></h2><p>The <code>-p</code> (<em>prompt</em>) option tells <code>xargs</code> to ask the user to confirm each command before it is run.</p><p>Let&#x27;s test this out by deleting a set of &#x27;pods&#x27; from a Kubernetes cluster. You don&#x27;t have to worry about what a Kubernetes cluster is, I&#x27;m just using this as an example to highlight that you don&#x27;t have to be limited to using <code>find</code> as the input for <code>xargs</code>!</p><p>On my machine I can show the pods available to me in my cluster with this command:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -o name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/my-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/postgres</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Three pods are shown. I could use this command to build input to <code>xargs</code> to let me to chose which pods to delete, interactively:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -o name | xargs -L 1 -p kubectl delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --context minikube delete pod/my-app?...n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --context minikube delete pod/nginx?...y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod &quot;nginx&quot; deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --context minikube delete pod/postgres?...n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is fantastic! We&#x27;ve used <code>-L 1</code> to make sure that we only deal with one pod at a time (rather than trying to delete all three at once) and the <code>-p</code> flag to ask the user to press &#x27;y&#x27; or &#x27;n&#x27; in each case. The <code>xargs</code> command helpfully shows us what it is going to do and asks for confirmation first.</p><p>I think this really hints at the true power of <code>xargs</code> - yes it can be combined with <code>find</code> to perform operations on files, but it can also be used with other tools to build more complex operations.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="splitting-up-input-with-a-delimiter">Splitting up Input with a Delimiter<a class="hash-link" href="#splitting-up-input-with-a-delimiter" title="Direct link to heading">â€‹</a></h2><p>We can ask the user whether they want to see files in <em>all</em> of their &#x27;path&#x27; locations with the command below:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo $PATH | xargs -d &#x27;:&#x27; -p -L 1 ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /home/dwmkerr/.pyenv/shims ?...n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /home/dwmkerr/.nvm/versions/node/v14.15.1/bin ?...n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>$PATH</code> environment variable holds all of the folders the shell will search in for binaries - and each folder is separated by a <code>:</code> colon character (you can read more about <code>$PATH</code> in <a href="/part-2-core-skills/finding-files">Chapter 10 - Understanding Commands</a>.</p><p>We use the <code>-d</code> (<em>delimiter</em>) parameter to tell <code>xargs</code> that each argument in the input is separated with a colon. We also use the <code>-L 1</code> and <code>-p</code> parameters to process this input one folder at a time and ask the user if they want to see the contents of the folder.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>In this chapter we introduced <code>xargs</code>, a powerful command which allows us to build other commands on the fly. We can trace, showing how the resulting command will look, ask the user for confirmation, control how many commands we run and more.</p><p>There are more options for the <code>xargs</code> command, you can read all about them with <code>man xargs</code>. But I think if you learn the key parameters we&#x27;ve shown in this chapter you&#x27;ll be well equipped to use <code>xargs</code> in your day to day wok.</p><p>In the next chapter we&#x27;ll look at some of the advanced features which are built into most shells which allow us to manipulate text.</p><div class="footnotes"><hr><ol><li id="fn-1">The character is ASCII NUL, which is the number zero. This is often used in programming to represent &#x27;null&#x27; or &#x27;nothing at all&#x27;, not the <em>digit</em> zero as is used when printing to the screen, which is actually represented by number 30. You can see the actual ASCII table with <code>man ascii</code>.<a href="#fnref-1" class="footnote-backref">â†©</a></li></ol></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dwmkerr/dwmkerr/main/docs/03-manipulating-text/17-build-commands-on-the-fly/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/part-3-manipulating-text/advanced-text-manipulation/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advanced Text Manipulation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/part-4-shell-scripting/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Part 4 - Shell Scripting</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introducing-xargs" class="table-of-contents__link toc-highlight">Introducing Xargs</a></li><li><a href="#handling-whitespace-special-characters-and-tracing" class="table-of-contents__link toc-highlight">Handling Whitespace, Special Characters and Tracing</a></li><li><a href="#one-command-or-many-commands" class="table-of-contents__link toc-highlight">One Command or Many Commands?</a></li><li><a href="#constructing-more-complex-commands-with-the-i-parameter" class="table-of-contents__link toc-highlight">Constructing more complex commands with the &#39;I&#39; Parameter</a></li><li><a href="#requesting-confirmation-with-the-prompt-option" class="table-of-contents__link toc-highlight">Requesting Confirmation with the Prompt Option</a></li><li><a href="#splitting-up-input-with-a-delimiter" class="table-of-contents__link toc-highlight">Splitting up Input with a Delimiter</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Effective Shell</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/effective-shell" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/dwmkerr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Dave Kerr. Website built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c9e750a8.js"></script>
<script src="/assets/js/main.feaa3aec.js"></script>
</body>
</html>