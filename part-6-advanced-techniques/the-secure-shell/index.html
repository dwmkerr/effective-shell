<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advanced-techniques/the-secure-shell/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">The Secure Shell | Effective Shell</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://effective-shell.com/part-6-advanced-techniques/the-secure-shell/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="google-site-verification" content="ca-pub-6181461532532600"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The Secure Shell | Effective Shell"><meta data-rh="true" name="description" content="So far we have been using the shell to operate on our local machine. We can use Secure Shell Protocol, or SSH, to open a secure network connection to a remote machine and use the shell to work on that machine."><meta data-rh="true" property="og:description" content="So far we have been using the shell to operate on our local machine. We can use Secure Shell Protocol, or SSH, to open a secure network connection to a remote machine and use the shell to work on that machine."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://effective-shell.com/part-6-advanced-techniques/the-secure-shell/"><link data-rh="true" rel="alternate" href="https://effective-shell.com/part-6-advanced-techniques/the-secure-shell/" hreflang="en"><link data-rh="true" rel="alternate" href="https://effective-shell.com/part-6-advanced-techniques/the-secure-shell/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8HZFMZV9Z4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8HZFMZV9Z4",{anonymize_ip:!0})</script>


<script src="https://cdn.jsdelivr.net/npm/docusaurus-plugin-drawio/viewer.min.js"></script>


<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6181461532532600" async></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6181461532532600" async></script><link rel="stylesheet" href="/assets/css/styles.48f2a3b2.css">
<link rel="preload" href="/assets/js/runtime~main.ffe37591.js" as="script">
<link rel="preload" href="/assets/js/main.2bfa30b0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Effective Shell Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Effective Shell Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Effective Shell</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sponsors/dwmkerr?frequency=one-time&amp;sponsor=dwmkerr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Buy me a Coffee!<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://amzn.to/4ho0F91" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Buy the Book on Amazon!<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/dwmkerr/terminal-ai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Terminal AI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://hacker-laws.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Hacker Laws<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div><a href="https://github.com/dwmkerr/effective-shell/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/part-1-transitioning-to-the-shell/">Transitioning to the Shell</a><button aria-label="Toggle the collapsible sidebar category &#x27;Transitioning to the Shell&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/part-2-core-skill/">Core Skills</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core Skills&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/part-3-manipulating-text/">Manipulating Text and Streams</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manipulating Text and Streams&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/part-4-shell-scripting/">Shell Scripting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Shell Scripting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/part-5-building-your-toolkit/">Building Your Toolkit</a><button aria-label="Toggle the collapsible sidebar category &#x27;Building Your Toolkit&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/part-6-advanced-techniques/">Advanced Techniques</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Techniques&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-6-advanced-techniques/understanding-shell-expansion/">Understanding Shell Expansion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-6-advanced-techniques/how-to-avoid-scripting/">How to Avoid Scripting - A Dictionary Lookup in Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/part-6-advanced-techniques/the-secure-shell/">The Secure Shell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-6-advanced-techniques/a-vim-crash-course/">A Vim Crash Course</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/part-6-advanced-techniques/master-the-multiplexer/">Master the Multiplexer</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/xx-appendices/installing-samples/">Appendices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zz-developer-guide/components">Developer Guide</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item"><amazonbookpreview title="Effective Shell" imageurl="https://m.media-amazon.com/images/I/71xI0lAzRzL._SL1500_.jpg" affiliatelink="https://amzn.to/4ho0F91"> </li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>The Secure Shell</h1></header><p>So far we have been using the shell to operate on our local machine. We can use <em>Secure Shell Protocol</em>, or <em>SSH</em>, to open a secure network connection to a remote machine and use the shell to work on that machine.</p><p>In this chapter we&#x27;ll look at how to setup the required credentials and keys to allow us to securely connect to a remote machine, how to create a virtual machine in the cloud and then how to connect to that machine from our local machine using the <code>ssh</code> program. We&#x27;ll also look at how to configure SSH to make it easier to work with!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-ssh">What is SSH?<a class="hash-link" href="#what-is-ssh" title="Direct link to heading">​</a></h2><p>SSH is the <em>Secure Shell Protocol</em>. It is a protocol that has been used for decades as a way to establish a secure connection to a remote machine, on your network or across the internet. The <em>program</em> named <code>ssh</code> is the &#x27;secure shell&#x27; - it is a program that helps you establish SSH connections, manage credentials, and open a shell on a remote machine.</p><p>When you connect to a remote machine, you will typically have to authenticate. It is possible to authenticate with a username and password. In most scenarios however you will have to use <em>Asymmetric Encryption</em> to authenticate with the server.</p><p>Asymmetric encryption uses special &#x27;keys&#x27;, called &#x27;public keys&#x27; and &#x27;private keys&#x27; to manage authentication and secure data. This might be new to you if you are used to using simple authentication protocols such as username and password. But public/private key based security is <em>extremely</em> secure and a great thing to know about! So let&#x27;s start by looking at how public and private keys work and then create our own key pair which we will later use to secure our connections.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="an-authentication-crash-course">An Authentication Crash Course<a class="hash-link" href="#an-authentication-crash-course" title="Direct link to heading">​</a></h2><p>The details of symmetric and asymmetric encryption complex and beyond the scope of this book<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>. We&#x27;ll cover the only essential concepts and techniques in this chapter.</p><p>Before we look at asymmetric encryption, let&#x27;s take a quick look at the challenges of symmetric encryption - which will help explain <em>why</em> asymmetric encryption is preferred.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="symmetric-encryption-for-authentication">Symmetric Encryption for Authentication<a class="hash-link" href="#symmetric-encryption-for-authentication" title="Direct link to heading">​</a></h3><p>When we use symmetric encryption, we have a shared &#x27;secret&#x27;, normally something like a username and password. If a user &#x27;Alice&#x27; wants to send a message to another user, &#x27;Bob&#x27;, we have to share the secret so that Bob can decrypt the message that Alice sends:</p>loading...<p>The diagram above is a hugely simplified view, but essentially shows that when the users want to exchange a message they <em>both</em> need to know the secret - one user uses the secret to encrypt the message, the other uses the same secret to decrypt it.</p><p>When you connect to a remote machine using symmetric authentication, you are the client (Alice) and the machine is the server (Bob).</p><p>Now in reality there are ways to obscure and protect this secret somewhat, but no matter how many clever tricks are used, we are still in the situation where the recipient has sensitive data - the user&#x27;s secret. This is actually quite problematic because it means if we don&#x27;t trust this user, or their machine or environment, we might not want to share a secret.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="asymmetric-encryption-for-authentication">Asymmetric Encryption for Authentication<a class="hash-link" href="#asymmetric-encryption-for-authentication" title="Direct link to heading">​</a></h3><p>When we use asymmetric encryption, Alice first creates a &#x27;key pair&#x27;. This is two files - a public key and a private key. Alice keeps the private key and sends the public key to Bob:</p>loading...<p>Now that Bob has the public key, he creates a secret that only he knows and then encrypts it with Alice&#x27;s public key. He then sends this secret to Alice. The secret was encrypted by Alice&#x27;s Public Key - meaning only the associated Private Key can decrypt it. This means <em>even if someone intercepts the secret</em> they cannot decrypt it! Only Alice can, as only Alice has the private key:</p>loading...<p>Now Alice has Bob&#x27;s secret and only she can decrypt it. Once she decrypts it both she and Bob have a shared secret - that no one has been able to intercept. They can now use Symmetric Encryption to exchange messages, safe in the knowledge that the secret is kept just between them.</p><p>The fantastic thing about this mechanism is that <em>only Alice can decrypt messages encrypted with her public key</em>. Alice can keep her key private. Her public key is not sensitive - it can only be used to encrypt messages for Alice.</p><p>Alice can also encrypt messages with her Private Key - anyone who has the Public Key can decrypt them. This means that this is not a secure way to encrypt a message - but it is a very good way to <em>sign</em> a message. Given that only Alice has the private key, only she can encrypt messages with it. This means if she sends a message encrypted with her private key anyone who has the public key can decrypt it to assert it was sent by Alice - she&#x27;s the only person with the private key.</p><p>This method of signing messages with the Private Key is not used to keep the message private but instead to verify the identity of the sender.</p><p>Most modern day cryptography protocols are based on this technique. In many of them Bob will not actually send back a secret - instead he&#x27;ll generate <em>his own</em> key-pair and return the Public Key. This is called a &#x27;key exchange&#x27;. Almost all modern day encryption is built on this mechanism - when you open a secure connection to a website, an exchange of keys is made between you and the server<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>.</p><p>When we use the secure shell to communicate with a remote machine, we will give the remote machine our <em>public key</em>, and we will encrypt our communications with the <em>private key</em>. This is essential because <em>other users</em> might have access to the remote machine - we don&#x27;t want them seeing our sensitive data such as passwords or private keys.</p><p>Let&#x27;s look at how to create a key-pair now.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-key-pair">Creating a Key Pair<a class="hash-link" href="#creating-a-key-pair" title="Direct link to heading">​</a></h2><p>We can use the <code>ssh-keygen</code> (<em>OpenSSH authentication key utility</em>)<!-- --> to create a key pair. We are going to use this key pair to communicate with a server that we will create on Amazon Web Services or AWS. AWS requires that we use a particular format known as <em>PEM</em>, so let&#x27;s create a key pair in that format now. We will move to the <em>~/.ssh</em> folder first, which is where users often store their SSH keys:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -m PEM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you run this command, it will ask you where you would like to save the file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Generating public/private rsa key pair.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter file in which to save the key (/home/dwmkerr/.ssh/id_rsa):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I suggest that you use the default location (the <em>~/.ssh</em> folder), but name the key pair &#x27;effective-shell&#x27;:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Enter file in which to save the key (/home/dwmkerr/.ssh/id_rsa): effective-shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter passphrase (empty for no passphrase):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point you will be asked to provide an optional passphrase. We will leave this blank as we are not going to use the server or key for any particularly sensitive data. However, if you are creating keys that will encrypt sensitive data you should definitely add a passphrase. If you add a passphrase, you&#x27;ll be required to enter each time you load the key. This adds a layer of security - if someone steals your private key they would have to know the passphrase to open it.</p><p>Once you have skipped the passphrase and passphrase confirmation by pressing the enter key twice, you&#x27;ll see the final output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Your identification has been saved in effective-shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your public key has been saved in effective-shell.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key fingerprint is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHA256:HcqIl3ZhRz9jvhYO3g64FEYT3mAoDc6P4mnh4aKuY08 dwmkerr@macbook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key&#x27;s randomart image is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---[RSA 3072]----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    .o .+ .      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   o. oo = .     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    o.  * + =    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     + * * + o   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  + o * S o o    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| + = o o + + o   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|. *E    o o =    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|o+.    . . +     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|*o..    .   .    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----[SHA256]-----+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The randomart shown is designed to provide a more user-friendly way to identify a key - if you have many keys you can see the randomart for each to pick the one you want. I have not yet met anyone who remembers their randomart so I think it&#x27;s safe for you to ignore it for now!</p><p>The essential thing is that we now have two new files - our public and private keys:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls | grep effective</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell.pub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The public key is the key with <code>.pub</code> at the end.</p><p>Now let&#x27;s create a new virtual machine in the cloud and provide it with our public key so that we can access it. To do this, we&#x27;re going to set up a virtual machine using Amazon Web Services - a popular cloud computing platform. We&#x27;ll use the free tier, meaning this should not cost you any money!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-an-aws-account">Setting up an AWS Account<a class="hash-link" href="#setting-up-an-aws-account" title="Direct link to heading">​</a></h2><p>We&#x27;re going to create a virtual machine in the cloud to connect to and test out <code>ssh</code>. We&#x27;ll do this using Amazon Web Services, which is probably the most popular cloud services provider. If you already have an account you can skip this part of the chapter. If not, we&#x27;ll look at how to setup an account now.</p><p>To sign up for an AWS account, open the site at:</p><p><a href="https://aws.amazon.com/account/sign-up" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/account/sign-up</a></p><p>Choose the &#x27;Create Free Account&#x27; option:</p><img loading="lazy" alt="Screenshot: Create Free Account" src="/assets/images/create-free-account-b40baad1adf05123d62f7572e097ea8f.png" width="800px" class="img_ev3q"><p>When you sign up you will be asked to provide quite a few personal details, as well as credit card details. Make sure you select the &quot;Basic Support Plan&quot;, which is free.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Avoiding Credit Card Bills</div><div class="admonitionContent_S0QG"><p>Amazon requires your credit card details in case you use paid services. In this chapter we will be using &#x27;free tier&#x27; services that have no costs, but be very careful if experimenting or playing with other services on AWS - most of them are will have some cost associated with their usage.</p><p>The costs are generally low and there are safeguards in place to ensure you don&#x27;t accidentally create expensive resources, but keep your AWS credentials <em>very</em> safe. If someone has access to them they could run expensive services on your account.</p></div></div><p>Once you have signed up successfully, you will see the &#x27;congratulations&#x27; message. You can now press the &#x27;Go to the AWS Management Console&#x27; button to go to the management console.</p><img loading="lazy" alt="Screenshot: Congratulations" src="/assets/images/aws-congratulations-4cded50a75870c1f24e22e09cc889449.png" width="800px" class="img_ev3q"><p>You will be asked for your password again. Congratulations - you now have an AWS account that you can use to run services in the cloud! Now let&#x27;s create a virtual machine that we can connect to.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-virtual-machine-on-aws">Creating a Virtual Machine on AWS<a class="hash-link" href="#creating-a-virtual-machine-on-aws" title="Direct link to heading">​</a></h2><p>Use the search bar in the AWS Management Console to search for &#x27;EC2&#x27;. EC2 is the name AWS uses for its virtual machine services.</p><p>The first thing we are going to do is upload our public key to AWS so that it can be used when we create our virtual machine. Select the &#x27;Key Pairs&#x27; option from the menu on the left or the dashboard:</p><img loading="lazy" alt="Screenshot: Dashboard - Key Pairs" src="/assets/images/aws-dashboard-keypairs-6fb245665dd23809d3e537f2d1851878.png" width="800px" class="img_ev3q"><p>When the key pairs view is open, choose &#x27;Actions &gt; Import Key Pair&#x27;:</p><img loading="lazy" alt="Screenshot: Import Key Pair" src="/assets/images/aws-import-key-pair-e66e68e77de3159f03ff19fa4440bdd0.png" width="800px" class="img_ev3q"><p>Give the key pair a sensible name and upload the <em>public</em> key file, which will be in <em>~/.ssh/effective-shell.pub</em> if you have been following with the tutorial. Alternatively you can open that file on your local machine and copy its contents:</p><img loading="lazy" alt="Screenshot: Import Key Pair Details" src="/assets/images/aws-import-key-pair-details-1d4cf6592734dd97d05033b372153cbb.png" width="800px" class="img_ev3q"><p>Now that the key pair has been imported we can go back to the EC2 dashboard and choose &#x27;Launch Instance&#x27;:</p><img loading="lazy" alt="Screenshot: Launch Instance" src="/assets/images/aws-launch-instance-a27d37a4beaab0cea4fb49b32799f890.png" width="800px" class="img_ev3q"><p>We are now going to go through a set of options to specify the details of the virtual machine AWS will create for us.</p><p><strong>Step 1: Choose an Amazon Machine Image (AMI)</strong></p><p>The first option should be <em>Amazon Linux 2 AMI (HVM) - Kernel 5.10, SSD Volume Type</em>, with a &#x27;Free Tier Eligible&#x27; label on the left. Press the blue &#x27;Select&#x27; button on the right of this machine to choose this instance type.</p><p><strong>Step 2: Choose an Instance Type</strong></p><p>Select the default <em>t2.micro</em> instance type. This is free-tier eligible and more than powerful enough for our needs.</p><p>Now press &#x27;Review and Launch&#x27; - we do not need to configure any of the advanced options.</p><p><strong>Step 3: Review Instance Launch</strong></p><p>There will be a warning saying that &#x27;your security group is open to the world&#x27; on this page. We can safely ignore that as we are not putting anything sensitive on this instance. This message is telling us that <em>anyone</em> who knows the address of our instance can try and connect to it.</p><p>This is not a problem for what we are doing, as we are creating this machine to experiment with and not putting sensitive data on it.</p><p>Press the &#x27;Launch&#x27; button on the bottom right - another screen will pop up, don&#x27;t dismiss this screen, it is where we will choose our key pair!</p><p>We will be asked to provide a key pair. Make sure the key pair you just imported is selected!</p><img loading="lazy" alt="Screenshot: Select Key Pair" src="/assets/images/aws-select-key-pair-acd5584bd22e7a93f66f4cf2bd026465.png" width="800px" class="img_ev3q"><p>You will be required to select the check box that says &quot;I acknowledge that I have access to the private key&quot; - this is AWS warning us that if we don&#x27;t have the private key associated with the public key we uploaded, we will not be able to connect to the instance.</p><p>Once you have checked the checkbox, you can choose &quot;Launch Instances&quot;.</p><p>Launching the instance will take a few seconds. Press the &quot;View Instances&quot; button when this is done.</p><p>Select the checkbox next to this new instance:</p><img loading="lazy" alt="Screenshot: Select Instance" src="/assets/images/aws-select-instance-476ce57f7b478a9145f29b226ddda177.png" width="800px" class="img_ev3q"><p>Once you have selected the instance, press the &#x27;Connect&#x27; button. In the screen that pops up, choose &#x27;SSH Client&#x27;:</p><img loading="lazy" alt="Screenshot: Connect to Instance" src="/assets/images/aws-connect-to-instance-f39a3426fa9dcdd818e7856f1d9a4423.png" width="800px" class="img_ev3q"><p>Keep this browser window open, it contains the details we need to know for the next steps.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Shut down your Virtual Machine when you are done with it!</div><div class="admonitionContent_S0QG"><p>When you have finished experimenting with your virtual machine, you should power it down. You can select it in the AWS Console and choose the &#x27;Instance State &gt; Stop Instance&#x27; option. When you are completely finished with the instance, choose &#x27;Instance State &gt; Terminate&#x27;. You should not be billed for this instance as it is in the free tier, but better safe than sorry!</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-ssh-to-connect-to-a-virtual-machine">Using SSH to connect to a virtual machine<a class="hash-link" href="#using-ssh-to-connect-to-a-virtual-machine" title="Direct link to heading">​</a></h2><p>Now that we have created a virtual machine, we can use the <code>ssh</code> program to open a connection to it and run a secure shell.</p><p>When we want to SSH onto a machine, we need to provide a few details:</p><ol><li>The address of the machine, which is its <em>hostname</em></li><li>The username for the user we are going to connect with</li><li>Credentials for the user we are going to connect with</li></ol><p>The address of the machine we have created will be shown in the &#x27;Connect to instance&#x27; page we should still have open from the AWS dashboard:</p><img loading="lazy" alt="Screenshot: Instance SSH Details" src="/assets/images/aws-instance-ssh-details-44d96c55f359b471be06ed14b77b092b.png" width="800px" class="img_ev3q"><p>AWS is giving us some hints here about how to connect, it is even showing the specific command we will run with <code>ssh</code>.</p><p>From our own shell we will now run the <code>ssh</code> command to connect to our instance. To connect, using the details for my new virtual machine, I would run this command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -i ~/.ssh/effective-shell ec2-user@ec2-13-213-71-135.ap-southeast-1.compute.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can see that we have provided three pieces of information:</p><ul><li>The credentials, by using the <code>-i</code> (<em>identity file</em>) flag, providing our <em>private key</em> file</li><li>The username, which is the <code>ec2-user</code> part of the command, coming before the at symbol <code>@</code></li><li>The hostname, which is the address that follows the <code>@</code></li></ul><p>When I run this command a warning is shown:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of host &#x27;ec2-13-213-71-135.ap-southeast-1.compute.amazonaws.com (13.213.71.135)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ED25519 key fingerprint is SHA256:8wq6Xu4xEk/BO3diae+BWUFTTKunzvCz4XidFYpl6F8.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This key is not known by any other names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is my SSH client telling me that I haven&#x27;t connected to this machine before so it cannot be sure that this machine is one I want to connect to. Once I continue, by entering <code>yes</code> and pressing enter, my SSH client will record the IP address of this machine, as well as it&#x27;s hostname, meaning that in the future when I connect it will recognise it. If the IP address <em>changes</em> my SSH client will warn me - this is a useful security feature to protect against someone &#x27;swapping&#x27; the machine you are connecting to for another one!</p><p>After typing <code>yes</code> and pressing enter to continue connecting, I will see Bash running in my AWS Linux virtual machine!</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Warning: Permanently added &#x27;ec2-13-213-71-135.ap-southeast-1.compute.amazonaws.com&#x27; (ED25519) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       __|  __|_  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       _|  (     /   Amazon Linux 2 AMI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ___|\___|___|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://aws.amazon.com/amazon-linux-2/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I have a welcome message from AWS and are running a shell on my virtual machine, via the <code>ssh</code> program from my local machine!</p><p>We can see the current shell being used by checking the <code>SHELL</code> variable:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$ echo $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We are now ready to run any commands that we like on this machine - at this point you might install programs, manipulate files and so on.</p><p>When I want to disconnect, I can just run the <code>exit</code> command to close the connection to the virtual machine.</p><p>Hopefully if you have followed this far, you also have access to a virtual machine to play with. Now let&#x27;s look at some of the things we can do with the SSH to make accessing these machines even easier!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dealing-with-key-permission-errors">Dealing with Key Permission Errors<a class="hash-link" href="#dealing-with-key-permission-errors" title="Direct link to heading">​</a></h2><p>It is possible that when you try to use a private key to connect to a virtual machine, you will see an error message like the below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Permissions 0644 for &#x27;my-key.pem&#x27; are too open.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">It is recommended that your private key files are NOT accessible by others.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This private key will be ignored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bad permissions: ignore key: my-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Permission denied (publickey).</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case the server is warning you that your private key could be opened by other users on the system. You can verify this by running <code>ls -a</code> to check the file permissions:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 dwmkerr  dwmkerr    1103 Apr 19 12:02 my-key.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you recall that the permissions are the first thing that is shown, you&#x27;ll see that they are <code>-rw-r--r--</code>. This translates to:</p><ul><li><code>-rw</code> - read and write for the owner, which is the <em>dwmkerr</em> user</li><li><code>-r-</code> - read to the group the owner belongs to, which is the <em>dwmkerr</em> group</li><li><code>-r-</code> - read to all users</li></ul><p>We can see that this is not ideal - other users on the system would be allowed to open the file, and members of the same group would also be allowed to read the file. There is a quick fix for this - set the permissions to read and write for the owner only:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod 400 my-key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------    1 dwmkerr  dwmkerr    1103 Apr 19 12:02 my-key.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>chmod</code> (<em>change file permissions</em>) command is used here to set the permissions to <code>400</code> - which means read and write for the current user. Once this change is made you will be able to SSH into the server without it complaining about the permissions on your key.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-ssh-hosts">Configuring SSH Hosts<a class="hash-link" href="#configuring-ssh-hosts" title="Direct link to heading">​</a></h2><p>It can be difficult to remember the details such as the host name, location of the key and username of your virtual machines. One thing you can do to make it far easier to connect is to create an entry in your <em>SSH Config</em> file that stores this information. This will let you connect much more quickly.</p><p>To create an entry for my virtual machine, I would add the following text to the <em>~/.ssh/config</em> file:</p><div class="language-title=&quot;~/.ssh/config&quot; codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-title=&quot;~/.ssh/config&quot; codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host effective-shell-aws-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostName ec2-13-213-71-135.ap-southeast-1.compute.amazonaws.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  User ec2-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IdentityFile &quot;~/.ssh/effective-shell.pem&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first part of this configuration is the host &#x27;alias&#x27; - how you will refer to the host when you want to connect to it. It can be convenient to give this a short but descriptive name. After this, we have a set of settings, each indented by a tab or two spaces, the settings we have are:</p><ul><li><code>HostName</code> the full address of the host</li><li><code>User</code> the name of the user to connect as</li><li><code>IdentityFile</code> the path to the private key file used to connect</li></ul><p>Now if I want to connect to the virtual machine, all I need to do is run the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> effective-shell-aws-linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In fact the <code>ssh</code> program supports shell completion, meaning I can just type <code>ssh</code> and a few letters of the host then the tab key - the shell will suggest the hosts from my config, so I don&#x27;t even need to remember the name I set for it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh e&lt;tab&gt; # when I press tab, the shell expands this to:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh effective-shell-aws-linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are many other options available for the SSH config file, you can see them all with <code>man ssh_config</code>. We&#x27;ll see some other options in <a href="/part-6-advanced-techniques/master-the-multiplexer/">Chapter 33 - Master the Multiplexer</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-ssh-commands">Running SSH Commands<a class="hash-link" href="#running-ssh-commands" title="Direct link to heading">​</a></h2><p>You don&#x27;t need to actually run a shell on a remote machine over SSH to execute commands. You can simply provide the commands that you want to run to the <code>ssh</code> program and it will execute them on the server.</p><p>Here&#x27;s an example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh effective-shell-aws-linux &#x27;curl effective.sh | ES_EXISTING_FOLDER_ACTION=o sh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: installed samples version 0.25.1 to &#x27;/home/ec2-user/effective-shell&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: read &#x27;effective shell&#x27; online at: www.effective-shell.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example we downloaded and ran the Effective Shell samples installer on the server. Now normally when we install the samples, the installer will ask the user whether to overwrite, delete or keep the existing samples. This means that it will be requesting input from the terminal. The <code>ssh</code> program is not actually attaching <em>stdin</em> to the remote machine, so we use the <code>ES_EXISTING_FOLDER_ACTION=o</code> option to tell the installer to overwrite the samples.</p><p>If we wanted to be able to interact with the server, using our terminal to provide input, we can use the <code>-t</code> (<em>request TTY</em>) parameter:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh -t effective-shell-aws-linux &#x27;curl effective.sh | sh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: downloaded samples, version 0.25.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: preparing to install the &#x27;effective-shell.com&#x27; samples...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: the &#x27;/home/ec2-user/effective-shell&#x27; folder already exists, would you like to:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: [d]elete - remove the existing folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: [o]verwrite - extract over the existing folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">effective-shell: [q]uit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your choice (d/o/q): d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example my terminal is attached to the remote server via SSH, meaning I can use the keyboard to provide input to the installer script.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-disconnections">Handling Disconnections<a class="hash-link" href="#handling-disconnections" title="Direct link to heading">​</a></h2><p>One thing that will soon become a pain if you are regularly SSH-ing into virtual machines is disconnections. This can occur when you lose network connectivity. You might not even notice that a disconnection has occurred - I find it is more common that the <code>ssh</code> session is simply frozen and not responding to any input at all.</p><p>It is annoying when this happens - often the shell is so unresponsive that you cannot even free it by pressing <code>^D</code> or <code>^C</code>. There is actually an escape sequence that you can use to end a broken session, which is the <code>Enter</code> then <code>~</code> then <code>.</code>.</p><p>In <a href="/part-6-advanced-techniques/master-the-multiplexer/">Chapter 33 - Master the Multiplexer</a> we&#x27;ll look at some great ways to improve upon this, for now if you forget the Enter/Tidle/Dot escape sequence the easiest thing to do is to close your terminal program.</p><p>When you disconnect from your SSH session, the commands you are running will be terminated. This is because your shell will send the &#x27;hang up&#x27; signal. Again, this can be frustrating if you actually want to keep something running on the server. We&#x27;ll also look at how to work around this behaviour in Chapter 33.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transferring-files-with-scp">Transferring Files with SCP<a class="hash-link" href="#transferring-files-with-scp" title="Direct link to heading">​</a></h2><p>We can use the <code>scp</code> (<em>OpenSSH secure file copy</em>)<!-- --> program to copy files to and from any remote machine that we have access to.</p><p>The format of the <code>scp</code> command is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp [parameters] &lt;source&gt; &lt;destination&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can provide <code>scp</code> with parameters, many of which are the same as the <code>ssh</code> command, such as <code>-i</code> for the <em>Identity File</em>.</p><p>The source and destination are normally a pair of designations, one local, one remote. However, you can also copy between two remote machines.</p><p>Some examples of how a command might look like are:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -i ~/.ssh/my-project.pem ~/project/output.zip dwmkerr@myserver.com:~</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This uses the <code>-i</code> flag to specify a key</li><li>The source is a file called <em>output.zip</em> on the local machine</li><li>The destination is a server with the hostname <code>myserver.com</code>, connecting with a user named <code>dwmkerr</code>, and putting the file in the user&#x27;s home folder</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -P </span><span class="token number" style="color:#36acaa">8022</span><span class="token plain"> effective-shell.com:~/downloads/backup.zip ~/backups</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This copies the <em>downloads/backups</em> folder to the local <em>~/backups</em> folder</li><li>No username or credentials are specified, so the current user&#x27;s name is used and any keys that are loaded in the SSH agent will be used to try and authenticate</li><li>We use the <code>-P</code> (<em>port number</em>) flag to specify port 8022, rather than the default port which is 22</li></ul><p>Let&#x27;s see this in action by copying the <code>lookup</code> tool we created in <a href="/part-6-advanced-techniques/how-to-avoid-scripting/">Chapter 30 - How to Avoid Scripting</a> to our server. Then we&#x27;ll run it, save some definitions, and copy them <em>back</em> to our local machine.</p><p>First we&#x27;ll use <code>scp</code> to copy our <code>lookup</code> program to our remote machine:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/effective-shell/samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scp ./programs/lookup/lookup.py effective-shell-aws-linux:~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lookup.py                    100% 4485    10.5KB/s   00:00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We have provided the path to the local file, and specified the server we want to copy the file to, as well as the location for the file (which is the home directory).</p><p>Note that because we have created the alias <code>effective-shell-aws-linux</code> in our SSH config, we can use this alias for <code>scp</code> as well as <code>ssh</code>. Let&#x27;s connect to the server now and run the script:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh effective-shell-aws-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Tue Apr  5 19:03:00 2022 from bb116-15-249-218.singnet.com.sg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       __|  __|_  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       _|  (     /   Amazon Linux 2 AMI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ___|\___|___|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://aws.amazon.com/amazon-linux-2/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$ ./lookup.py cryptography</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cryptography: The discipline concerned with communication security (eg, confiden</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tiality of messages, integrity of messages, sender authentication, non-repudiati</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on of messages, and many other related issues), regardless of the used medium su</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ch as pencil and paper or computers.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see that our lookup program has been copied to our server and we can run it to find a definition for the word &#x27;cryptography&#x27;.</p><p>Let&#x27;s save this definition then close our connection to the server, then copy the definition back to our local machine:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$ chmod +x ./lookup.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$ ./lookup.py cryptography &gt; definition.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ec2-user@ip-172-31-23-196 ~]$ exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to ec2-13-213-71-135.ap-southeast-1.compute.amazonaws.com closed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ scp effective-shell-aws-linux:~/defintion.txt .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">definition.txt               100%  277     1.0KB/s   00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat definition.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cryptography: The discipline concerned with communication security (eg, confiden</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tiality of messages, integrity of messages, sender authentication, non-repudiati</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on of messages, and many other related issues), regardless of the used medium su</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ch as pencil and paper or computers.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Before we ran the script on the server, we used the <code>chmod</code> (<em>change file permissions</em>) command to ensure the script can be executed. That&#x27;s all there is to it! Copying files and folders to and from remote machines is remarkably easy to do with <code>scp</code> once you know the basics of how <code>ssh</code> works.</p><p>There are many other operations that you can perform with <code>scp</code>, you can read more about the tool with <code>man scp</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a class="hash-link" href="#next-steps" title="Direct link to heading">​</a></h2><p>Once you are familiar with the core techniques introduced in this chapter, I would suggest that you look into configuration for <em>bastion hosts</em>, <em>port forwarding</em> and <em>VPN tunneling</em> - these are two more advanced scenarios for SSH. As a teaser for when you might want to use some of these techniques, consider the diagram below:</p>loading...<p>In this scenario we have two hosts, <em>host1.myproject</em> and <em>host2.myproject</em> in a private part of a network, that is not open to the internet. To access these hosts, we use a &#x27;jump box&#x27; or &#x27;bastion&#x27; - a host that is running in a part of the network that is accessible to external users. We carefully control access to this box and use it as way to connect to the private host.</p><p>Now you could SSH onto the bastion, and then SSH onto either of the hosts. But you can speed this process up by setting your <em>~/.ssh/config</em> like so:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host bastion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HostName bastion.myproject.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IdentityFile ~/.ssh/myproject.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ForwardAgent yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host *.myproject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ProxyJump bastion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this configuration we can connect to either of the private hosts by simply using the <code>ssh</code> command with the host name:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh host1.internal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ssh</code> program recognises that <code>host1.internal</code> matches the patter <code>*.myproject</code> from our configuration file. It then sees that we have set the <code>ProxyJump</code> option, which instructs <code>ssh</code> to connect through another host. The other host is the bastion, which is accessible to the user, and has the key specified. We also tell the bastion that it should have its authentication forwarded, so that our private key is used when connecting to the host in the private network (without this option when we connect to the bastion we will not have our keys accessible).</p><p>This network configuration is very common and you can see the SSH configuration file supports quickly and conveniently configuring the SSH agent to use the bastion.</p><p>There are many advanced options for SSH that will make more complex tasks like this easier to manage.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>In this chapter we discussed the SSH protocol, and how keys are used to protect connections to remote servers. We saw how to setup an AWS account, create a virtual machine with a given public key, connect to it with the <code>ssh</code> program, and configure SSH with an alias to make future connections faster. We also saw some of the challenges we can face with network connectivity - which we&#x27;ll see techniques to handle in Chapter 33. Finally, we looked at how to copy files to and from remote machines.</p><div class="footnotes"><hr><ol><li id="fn-1">If you want to go deeper, my favourite book on this topic is &quot;Applied Cryptography: Protocols, Algorithms, and Source Code in C - Bruce Schneier&quot;. There are more details at the end of the chapter and in the <a href="/xx-appendices/recommended-reading/">Recommended Reading</a> section.<a href="#fnref-1" class="footnote-backref">↩</a></li><li id="fn-2">This process is very useful to know about, it is called Diffie–Hellman key exchange. There are many great articles online that explain it in detail.<a href="#fnref-2" class="footnote-backref">↩</a></li></ol></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dwmkerr/effective-shell/edit/main/docs/06-advanced-techniques/31-the-secure-shell/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/part-6-advanced-techniques/how-to-avoid-scripting/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How to Avoid Scripting - A Dictionary Lookup in Python</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/part-6-advanced-techniques/a-vim-crash-course/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A Vim Crash Course</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-ssh" class="table-of-contents__link toc-highlight">What is SSH?</a></li><li><a href="#an-authentication-crash-course" class="table-of-contents__link toc-highlight">An Authentication Crash Course</a><ul><li><a href="#symmetric-encryption-for-authentication" class="table-of-contents__link toc-highlight">Symmetric Encryption for Authentication</a></li><li><a href="#asymmetric-encryption-for-authentication" class="table-of-contents__link toc-highlight">Asymmetric Encryption for Authentication</a></li></ul></li><li><a href="#creating-a-key-pair" class="table-of-contents__link toc-highlight">Creating a Key Pair</a></li><li><a href="#setting-up-an-aws-account" class="table-of-contents__link toc-highlight">Setting up an AWS Account</a></li><li><a href="#creating-a-virtual-machine-on-aws" class="table-of-contents__link toc-highlight">Creating a Virtual Machine on AWS</a></li><li><a href="#using-ssh-to-connect-to-a-virtual-machine" class="table-of-contents__link toc-highlight">Using SSH to connect to a virtual machine</a></li><li><a href="#dealing-with-key-permission-errors" class="table-of-contents__link toc-highlight">Dealing with Key Permission Errors</a></li><li><a href="#configuring-ssh-hosts" class="table-of-contents__link toc-highlight">Configuring SSH Hosts</a></li><li><a href="#running-ssh-commands" class="table-of-contents__link toc-highlight">Running SSH Commands</a></li><li><a href="#handling-disconnections" class="table-of-contents__link toc-highlight">Handling Disconnections</a></li><li><a href="#transferring-files-with-scp" class="table-of-contents__link toc-highlight">Transferring Files with SCP</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Effective Shell</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a href="https://amzn.to/4ho0F91" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="right">Buy the Book on Amazon!<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sponsors/dwmkerr?frequency=one-time&amp;sponsor=dwmkerr" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="right">Buy me a Coffee!<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Other Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/dwmkerr/terminal-ai" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="right">Terminal AI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://hacker-laws.com" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="right">Hacker Laws<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/dwmkerr/effective-shell" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dwmkerr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Effective Shell v0.36.0. Copyright © 2025 Dave Kerr. Website built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ffe37591.js"></script>
<script src="/assets/js/main.2bfa30b0.js"></script>
</body>
</html>